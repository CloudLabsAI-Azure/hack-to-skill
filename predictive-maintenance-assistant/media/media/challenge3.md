# Challenge 3: Add Predictive Intelligence to the Maintenance Copilot using Azure AI Foundry and Machine Learning
  
## Problem Statement

Reactive maintenance is costly and inefficient. In this final challenge, you’ll use Azure AI Foundry and Azure Machine Learning to introduce **predictive intelligence** into your Copilot. This stage enables anomaly detection, predictive failure forecasting, and automated maintenance recommendations, turning your assistant into a proactive maintenance advisor.

## Goals

- Integrate Azure AI Foundry and Azure Machine Learning models for predictive analytics.  
- Detect anomalies and predict potential equipment failures using IoT telemetry.  
- Automate maintenance recommendations, alerts, and scheduling in Teams.

## Datasets  

- Use the dataset `C:\datasets\equipment_telemetry.csv` to simulate real-time IoT telemetry (temperature, vibration, voltage, pressure).  
- The dataset supports training and inference for anomaly detection and predictive maintenance.

## Challenge Objectives  

1. **Azure Machine Learning Workspace Setup**
   - In the Azure portal, create an **Azure Machine Learning Workspace** named `predictive-maintenance-ml`.
   - Create a new **Compute Instance** (Standard_DS11_v2 or equivalent).
   - Upload `equipment_telemetry.csv` to the workspace.
   - Open the **Azure ML Studio** and:
     - Create a **new dataset** from the uploaded CSV.
     - Develop an **AutoML Regression** or **Classification** experiment to predict failures.
     - Use features such as *temperature*, *vibration*, and *runtime hours*.
     - Select the target label (e.g., `FailureFlag` or `RemainingUsefulLife`).
   - Deploy the trained model as a **real-time endpoint** named `PredictiveMaintenanceEndpoint`.

2. **Azure AI Foundry Integration**
   - In Azure AI Foundry, create a new **project** named `MaintenanceInsightsFoundry`.
   - Add a **Language Model deployment**:
     - **Model:** GPT-4-turbo.
     - Purpose: Generate maintenance summaries and recommendations.
   - Create a **Custom Prompt Flow** that:
     - Takes predicted outputs from ML (e.g., probability of failure).
     - Generates a human-readable summary such as:
       - *“Compressor #12 shows early signs of bearing wear. Schedule inspection within 48 hours.”*
   - Expose the flow via a REST endpoint.

3. **Azure Function Connector**
   - Create an **Azure Function App** named `maintenance-intelligence-func` using an **HTTP trigger**.
   - Implement logic to:
     - Accept equipment ID or telemetry data.
     - Query the ML endpoint for failure probability.
     - Pass the results to Azure AI Foundry for reasoning.
     - Return a JSON response such as:
       ```json
       {
         "EquipmentID": "EQP-12",
         "FailureProbability": 0.82,
         "Recommendation": "Inspect motor bearings and lubrication within 48 hours."
       }
       ```
   - Secure endpoints with Azure AD authentication and test locally using sample inputs.

4. **Copilot Studio Integration**
   - In **Copilot Studio**, add a new topic called **PredictiveMaintenance**.
   - Add trigger phrases such as:
     - `What’s likely to fail next?`
     - `Show me anomaly predictions.`
     - `Give me maintenance recommendations for compressor 12.`
   - Add an **Action Node** that calls your Azure Function endpoint.
   - Pass the equipment ID or telemetry context from the conversation.
   - Parse and display the response in a conversational summary format.

5. **Automation and Teams Notifications**
   - Use **Power Automate** to connect your Copilot with Teams and Dataverse:
     - When a prediction exceeds a threshold (e.g., FailureProbability > 0.7):
       - Automatically create a **Maintenance Work Order** record in Dataverse.
       - Send a **Teams notification** to the assigned maintenance engineer.
   - Example message:
     > “⚙️ Predictive alert: Equipment EQP-12 shows 82% failure probability. Inspection scheduled for today 3 PM.”

6. **Visualization in Power BI**
   - Create a Power BI dashboard with:
     - Live telemetry trends (temperature, vibration).
     - Predicted failure probability chart by equipment.
     - Maintenance tasks generated by AI recommendations.
   - Connect Power BI to Dataverse or Azure SQL for real-time updates.

7. **Testing**
   - Test the Copilot by asking:
     - `Which equipment needs attention this week?`
     - `Summarize all high-risk assets.`
     - `Recommend maintenance actions for pump 5.`

## Success Criteria  

- Copilot provides predictive maintenance insights and recommendations through Azure AI Foundry and ML models.  
- Automated alerts and work orders trigger seamlessly in Teams via Power Automate.  
- Power BI dashboards visualize anomaly trends and maintenance KPIs.

## Additional Resources

- [Azure Machine Learning Quickstart](https://learn.microsoft.com/en-us/azure/machine-learning/quickstart-create-resources)
- [Azure AI Foundry Overview](https://learn.microsoft.com/en-us/azure/ai-studio/)
- [Deploy Real-Time ML Endpoints](https://learn.microsoft.com/en-us/azure/machine-learning/how-to-deploy-online-endpoints)
- [Copilot Studio + Power Automate Integration](https://learn.microsoft.com/en-us/microsoft-copilot-studio/power-automate-integration)

## Conclusion  

You’ve successfully enhanced your **Predictive Maintenance Copilot** with predictive intelligence. The system can now interpret IoT data, forecast potential failures, generate maintenance insights, and automate work orders—empowering manufacturing teams with proactive, data-driven operations and reduced downtime.